{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat-App</title>
  <link rel="stylesheet" href="{% static 'accounts/chat.css' %}">
</head>
<body>
    <div>
        <div class="head">
    <img class="profile" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQNfTkosk_XISYGUe8YAUWMrv0kcP5a4YMcVQ&s" alt="Profile picture" />
        <h1 class="person">Nikhil Singh Rathore</h1>
       </div>
       <hr>
       <div class="online-show">Online 2</div>
        <div id="messages" class="message-box">
              {% for message in messages%}
              {% include 'accounts/chatnewdata.html'%}
              {% endfor %}
        </div>
        
        <form method="post"
          action="{% url 'bodymessage' %}"
          hx-post="{% url 'bodymessage' %}"
          hx-target="#messages"
          hx-swap="beforeend"
          hx-trigger="submit"
          class="messages-type">
      {% csrf_token %}
      {{ form.body }}
      <button class="message-button" type="submit">></button>
    </form>
  </div>

  <script src="https://unpkg.com/htmx.org@1.9.4"></script>

  <script>
    // debug
    console.log('htmx present?', typeof htmx !== 'undefined');

    // on successful swap: clear input and scroll to bottom
    document.body.addEventListener('htmx:afterSwap', function(e){
      const input = document.querySelector('input[name="body"], textarea[name="body"]');
      if (input) input.value = '';
      const msgs = document.getElementById('messages');
      if (msgs) msgs.scrollTop = msgs.scrollHeight;
    });

    // optional: when the page first loads, scroll to bottom
    window.addEventListener('load', function(){ 
      const msgs = document.getElementById('messages');
      if (msgs) msgs.scrollTop = msgs.scrollHeight;
    });
  </script>
</html>
